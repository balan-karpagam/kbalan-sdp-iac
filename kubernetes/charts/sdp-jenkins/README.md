# SDP Jenkins Helm Chart

Sourced from upstream  Helm chart https://github.com/helm/charts/tree/master/stable/jenkins
Customized for use with Booz Allen Solutions Delivery Platform

## Chart Details

This chart will do the following:

* 1 x Jenkins Master with port 8080 exposed on an external LoadBalancer or Ingress or Route
* Optionally install Persistent Jenkins Agents

## Configuration

The following tables list the configurable parameters of the Jenkins chart and their default values.

### General

| Parameter                         | Description                          | Default                                   |
| --------------------------------- | ------------------------------------ | ----------------------------------------- |
| `numAgents`                | Number of persistent Jenkins Agents    | `1`                                 |
| `peristentSlaveEnabled`                | Enable persistent Jenkins Agents    | `true`                                 |
| `nameOverride`                    | Override the resource name prefix    | `jenkins`                                 |
| `fullnameOverride`                | Override the full resource names     | `jenkins-{release-name}` (or `jenkins` if release-name is `jenkins`) |
| `namespaceOverride`               | Override the deployment namespace    | Not set (`Release.Namespace`)             |
| `checkDeprecation`                | Checks for deprecated values used    | `true`                                 |
| `networkPolicy.enabled`           | Enable creation of NetworkPolicy resources. | `false`                            |
| `networkPolicy.apiVersion`        | NetworkPolicy ApiVersion             | `networking.k8s.io/v1`                    |
| `rbac.create`                     | Whether RBAC resources are created   | `true`                                    |
| `scc.create`                     | Whether Openshift SCC resources are created   | `true`                                    |
| `serviceAccount.name`             | name of the ServiceAccount to be used by access-controlled resources | autogenerated |
| `serviceAccount.create`           | Configures if a ServiceAccount with this name should be created | `true`         |
| `serviceAccount.annotations`      | Configures annotation for the ServiceAccount | `{}`                              |
| `serviceAccountAgent.name`        | name of the agent ServiceAccount to be used by access-controlled resources | autogenerated |
| `serviceAccountAgent.create`      | Configures if an agent ServiceAccount with this name should be created | `false`         |
| `serviceAccountAgent.annotations` | Configures annotation for the agent ServiceAccount | `{}`                              |
| `persistence.enabled` | Enables provisioning of persistent volumes on Jenkins master | `false`                              |
| `persistence.existingClaim` | Name of existing persistent volume claim to use  | `jenkins`                              |
| `persistence.storageClass` | Configures the name of the storage class to create the persistent volume claim with  | `gp2`                              |
| `persistence.annotations` | Configures annotations toa dd the  persistent volume claim   | `{}`                              |
| `persistence.accessMode` | Configures the access mode for the persistent volume claim   | `ReadWriteOnce`                              |
| `persistence.size` | Configures the size of the persistent volume claim   | `50Gi`                              |

### Jenkins Master

| Parameter                         | Description                          | Default                                   |
| --------------------------------- | ------------------------------------ | ----------------------------------------- |
| `master.componentName`            | Jenkins master name                  | `jenkins-master`                          |
| `master.image`                    | Master image name                    | `jenkins/jenkins`                         |
| `master.tag`                      | Master image tag                     | `lts`                                     |
| `master.imagePullPolicy`          | Master image pull policy             | `Always`                                  |
| `master.imagePullSecretName`          | Master image pull secret             | Not set                                   |
| `master.lifecycle`                | Lifecycle specification for master-container | Not set                           |
| `master.numExecutors`             | Set Number of executors              | 0                                         |
| `master.customJenkinsLabels`      | Append Jenkins labels to the master  | `{}`                                      |
| `master.useSecurity`              | Use basic security                   | `true`                                    |
| `master.securityRealm`            | Custom Security Realm                | Not set                                   |
| `master.authorizationStrategy`    | Jenkins XML job config for AuthorizationStrategy | Not set                       |
| `master.adminUser`                | Admin username (and password) created as a secret if useSecurity is true | `admin` |
| `master.adminPassword`            | Admin password (and user) created as a secret if useSecurity is true | Random value |
| `master.adminSshKey`            | ssh key used by the Configuration Auto Reload sidecar | defaults to a value automatically generated |
| `master.rollingUpdate`            | Configures rolling update strategy for Jenins master | {} |
| `master.resources`                | Resources allocation (Requests and Limits) | `{requests: {cpu: 50m, memory: 256Mi}, limits: {cpu: 2000m, memory: 4096Mi}}`|
| `master.javaOpts`                  | Configure additional Java Opts           | Not set                                   |
| `master.usePodSecurityContext`    | Enable pod security context (must be `true` if `runAsUser` or `fsGroup` are set) | `true` |
| `master.runAsUser`                | uid that jenkins runs with           | `0`                                       |
| `master.fsGroup`                  | uid that will be used for persistent volume | `0`                                |
| `master.servicePort`              | k8s service port                     | `8080`                                    |
| `master.targetPort`               | k8s target port                      | `8080`                                    |
| `master.serviceAnnotations`       | Service annotations                  | `{}`                                      |
| `master.serviceType`              | k8s service type                     | `LoadBalancer`                            |
| `master.deploymentLabels`         | Custom Deployment labels             | Not set                                   |
| `master.serviceLabels`            | Custom Service labels                | Not set                                   |
| `master.podLabels`                | Custom Pod labels                    | Not set                                   |
| `master.nodePort`                 | k8s node port                        | Not set                                   |
| `master.healthProbes`             | Enable k8s liveness and readiness probes    | `true`                             |
| `master.healthProbesLivenessTimeout`  | Set the timeout for the liveness probe  | `5`                              |
| `master.healthProbesReadinessTimeout` | Set the timeout for the readiness probe | `5`                               |
| `master.healthProbeLivenessPeriodSeconds` | Set how often (in seconds) to perform the liveness probe | `10`         |
| `master.healthProbeReadinessPeriodSeconds` | Set how often (in seconds) to perform the readiness probe | `10`         |
| `master.healthProbeLivenessFailureThreshold` | Set the failure threshold for the liveness probe | `5`               |
| `master.healthProbeReadinessFailureThreshold` | Set the failure threshold for the readiness probe | `3`               |
| `master.healthProbeLivenessInitialDelay` | Set the initial delay for the liveness probe | `90`               |
| `master.healthProbeReadinessInitialDelay` | Set the initial delay for the readiness probe | `60`               |
| `master.slaveListenerPort`        | Listening port for agents            | `50000`                                   |
| `master.slaveHostPort`            | Host port to listen for agents            | Not set                              |
| `master.disabledAgentProtocols`   | Disabled agent protocols             | `JNLP-connect JNLP2-connect`              |
| `master.csrf.defaultCrumbIssuer.enabled` | Enable the default CSRF Crumb issuer | `true`                             |
| `master.csrf.defaultCrumbIssuer.proxyCompatability` | Enable proxy compatibility | `true`                            |
| `master.cli`                      | Enable CLI over remoting             | `false`                                   |
| `master.loadBalancerSourceRanges` | Allowed inbound IP addresses         | `0.0.0.0/0`                               |
| `master.loadBalancerIP`           | Optional fixed external IP           | Not set                                   |
| `master.jmxPort`                  | Open a port, for JMX stats           | Not set                                   |
| `master.extraPorts`               | Open extra ports, for other uses     | Not set                                   |
| `master.installPlugins`           | List of Jenkins plugins to install. If you don't want to install plugins set it to `[]` | `kubernetes:1.18.1 workflow-aggregator:2.6 credentials-binding:1.19 git:3.11.0 workflow-job:2.33` |
| `master.overwritePlugins`         | Overwrite installed plugins on start.| `false`                                   |
| `master.enableRawHtmlMarkupFormatter` | Enable HTML parsing using (see below) | false                                |
| `master.scriptApproval`           | List of groovy functions to approve  | Not set                                   |
| `master.initScripts`              | List of Jenkins init scripts         | Not set                                   |
| `master.secretsFilesSecret`       | Kubernetes secret that contains 'secrets' files | Not set                        |
| `master.secretsMountPath`       | Mount Path for Kubernetes secret that contains 'secrets' files | Not set                        |
| `master.jobs`                     | Jenkins XML job configs              | `{}`                                      |
| `master.JCasC.enabled`            | Wheter Jenkins Configuration as Code is enabled or not | `false`                 |
| `master.JCasC.pluginVersion`            | version of JCasC plugin installed | `1.29`                 |
| `master.JCasC.configScripts`      | List of Jenkins Config as Code scripts | False                                   |
| `master.customInitContainers`     | Custom init-container specification in raw-yaml format | Not set                 |
| `master.sidecars.configAutoReload` | Jenkins Config as Code auto-reload settings |                                   |
| `master.sidecars.configAutoReload.enabled` | Jenkins Config as Code auto-reload settings (Attention: rbac needs to be enabled otherwise the sidecar can't read the config map) | `false`                                                      |
| `master.sidecars.configAutoReload.image` | Image which triggers the reload | `shadwell/k8s-sidecar:0.0.2`            |
| `master.sidecars.configAutoReload.imagePullPolicy` | Pull policy for side car image | `Always`            |
| `master.sidecars.configAutoReload.resources` | Configures resources to be allocated for the side car container | `Not set`            |
| `master.sidecars.configAutoReload.sshTcpPort` | Configures the port for Jenkins Master ssh access | `1044`            |
| `master.sidecars.configAutoReload.folder` | Configures the folder where the JCasC configurations are stored | `/var/jenkins_home/casc_configs`            |
| `master.sidecars.configAutoReload.searchNamespace` | Configures the namespace in which to watch for configuartion changes if other than default | `Not set`            |
| `master.sidecars.other`          | Configures additional sidecar container(s) for Jenkins master | `{}`             |
| `master.nodeSelector`             | Node labels for pod assignment       | `{}`                                      |
| `master.tolerations`              | Toleration labels for pod assignment | `[]`                                      |
| `master.podAnnotations`           | Annotations for master pod           | `{}`                                      |
| `master.customConfigMap`          | Deprecated: Use a custom ConfigMap   | `false`                                   |
| `master.overwriteConfig`          | Replace init scripts and config w/ ConfigMap on boot  | `false`                  |
| `master.overwriteJobs`            | Replace jobs w/ ConfigMap on boot    | `false`                                   |
| `master.affinity`                 | Affinity settings                    | `{}`                                      |
| `master.ingress.enabled`          | Enables ingress                      | `false`                                   |
| `master.ingress.apiVersion`       | Ingress API version                  | `extensions/v1beta1`                      |
| `master.ingress.hostName`         | Ingress host name                    | sdp.jenkins.com                                   |
| `master.ingress.annotations`      | Ingress annotations                  | `{}`                                      |
| `master.ingress.labels`           | Ingress labels                       | `{}`                                      |
| `master.ingress.path`             | Ingress path                         | Not set                                   |
| `master.ingress.tls`              | Ingress TLS configuration            | `[]`                                      |
| `master.backendconfig.enabled`     | Enables backendconfig     | `false`              |
| `master.backendconfig.apiVersion`  | backendconfig API version | `extensions/v1beta1` |
| `master.backendconfig.name`        | backendconfig name        | Not set              |
| `master.backendconfig.annotations` | backendconfig annotations | `{}`                 |
| `master.backendconfig.labels`      | backendconfig labels      | `{}`                 |
| `master.backendconfig.spec`        | backendconfig spec        | `{}`                 |
| `master.route.enabled`            | Enables openshift route              | `false`                                   |
| `master.route.annotations`        | Route annotations                    | `{}`                                      |
| `master.route.labels`             | Route labels                         | `{}`                                      |
| `master.route.path`               | Route path                           | sdp.jenkins.com                                   |
| `master.jenkinsUrlProtocol`       | Set protocol for JenkinsLocationConfiguration.xml | Set to `https` if `Master.ingress.tls`, `http` otherwise |
| `master.enableXmlConfig`          | enables configuration done via XML files | `false`                               |
| `master.jenkinsUriPrefix`         | Root Uri Jenkins will be served on   | Not set                                   |
| `master.hostAliases`              | Aliases for IPs in `/etc/hosts`      | `[]`                                      |
| `master.prometheus.enabled`       | Enables prometheus service monitor | `false`                                     |
| `master.prometheus.serviceMonitorAdditionalLabels` | Additional labels to add to the service monitor object | `{}`                       |
| `master.prometheus.serviceMonitorNamespace` | Custom namespace for serviceMonitor | Not set (same ns where is Jenkins being deployed) |
| `master.prometheus.scrapeInterval` | How often prometheus should scrape metrics | `60s`                              |
| `master.prometheus.scrapeEndpoint` | The endpoint prometheus should get metrics from | `/prometheus`                 |
| `master.prometheus.alertingrules` | Array of prometheus alerting rules | `[]`                                        |
| `master.prometheus.alertingRulesAdditionalLabels` | Additional labels to add to the prometheus rule object     | `{}`                                   |
| `master.priorityClassName`        | The name of a `priorityClass` to apply to the master pod | Not set               |


### Jenkins Persistent Agent

| Parameter                         | Description                          | Default                                   |
| --------------------------------- | ------------------------------------ | ----------------------------------------- |
| `agent.enabled`            | Set if persistent Jenkins agents are enabled                  | `true`                          |
| `agent.image`                    | Jenkins Agent image name                    | `docker.pkg.github.com/boozallen/sdp-images/jenkins-agent`                         |
| `agent.tag`                    | Jenkins Agent image tag                     | `ubi-1.0`                         |
| `agent.imagePullPolicy`                    | Jenkins Agent image pull policy                    | `IfNotPresent`                         |
| `agent.imagePullSecretName`                    | Jenkins Agent image pull secret name                    | `Not set`                         |
| `agent.customJenkinsLabels`                    | Jenkins Agent image custom labels                    | `Not set`                         |
| `agent.componentName`                    | Name of the SDP component                    | `jenkins-agent`                         |
| `agent.privileged`                    | Configures Jenkins Agent to run inprivileged mode                    | `true`                         |
| `agent.resources.requests.cpu`                    | Configures Jenkins Agent requested cpu resource utilization                    | `500m`                         |
| `agent.resources.requests.memory`                    | Configures Jenkins Agent requested memory resource utilization                    | `256Mi`                         |
| `agent.resources.limits.cpu`                    | Configures Jenkins Agent limit on cpu resource utilization                    | `1`                         |
| `agent.resources.limits.memory`                    | Configures Jenkins Agent limit on memory resource utilization                    | `512Mi`                         |
| `agent.nodeSelector`                    | Configures Jenkins Agent to nodes withspecific labels                    | `Not set`                         |
